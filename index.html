<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>AgentSpark â€” Build Your AI Team</title>

  <!-- PWA meta -->
  <meta name="theme-color" content="#1a170d" id="meta-theme-color" />
  <meta name="description"
    content="Build your AI agent team in minutes. Choose a topic, answer questions, get production-ready agent files." />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="AgentSpark" />

  <!-- PWA manifest -->
  <link rel="manifest" href="manifest.json" id="pwa-manifest" />

  <!-- PWA icons -->
  <link rel="apple-touch-icon" href="assets/icon-192.png" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link
    href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&family=Space+Mono:wght@400;700&display=swap"
    rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@400,0..1&display=swap"
    rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <link rel="stylesheet" href="css/main.css">
</head>

<body>
  <div class="offline-bar" id="offline-bar">ğŸ“¡ You're offline â€” AgentSpark loaded from cache</div>

  <!-- â”€â”€ NAV DRAWER â”€â”€ -->
  <div id="nav-drawer-overlay" onclick="closeDrawer()"></div>
  <div id="nav-drawer" role="navigation" aria-label="Main navigation">
    <div class="drawer-header">
      <span class="drawer-logo">âš¡ AgentSpark</span>
      <button class="drawer-close" onclick="closeDrawer()" aria-label="Close menu">âœ•</button>
    </div>
    <nav class="drawer-nav">
      <span class="drawer-section-label">Navigate</span>
      <button class="drawer-nav-item" onclick="closeDrawer();showScreen('topic')" id="dnav-home">
        <span class="dnav-icon">ğŸ </span>
        <span class="dnav-label">Home / Topics</span>
      </button>
      <button class="drawer-nav-item" onclick="closeDrawer();showScreen('projects')" id="dnav-projects">
        <span class="dnav-icon">ğŸ“</span>
        <span class="dnav-label">My Projects</span>
        <span class="dnav-badge" id="dnav-badge" style="display:none;"></span>
      </button>
      <button class="drawer-nav-item" onclick="closeDrawer();showScreen('chat')" id="dnav-chat">
        <span class="dnav-icon">ğŸ’¬</span>
        <span class="dnav-label">Chat / Interview</span>
      </button>
      <button class="drawer-nav-item" onclick="closeDrawer();showScreen('results')" id="dnav-results">
        <span class="dnav-icon">âš¡</span>
        <span class="dnav-label">Results / Agents</span>
      </button>
      <div class="drawer-divider"></div>
      <span class="drawer-section-label">Actions</span>
      <button class="drawer-nav-item" onclick="closeDrawer();showInstructions()">
        <span class="dnav-icon">ğŸ“–</span>
        <span class="dnav-label">Instructions</span>
      </button>
      <button class="drawer-nav-item" onclick="closeDrawer();openShareModal()">
        <span class="dnav-icon">ğŸ”—</span>
        <span class="dnav-label">Share / Export</span>
      </button>
      <button class="drawer-nav-item" onclick="closeDrawer();openImportModal()">
        <span class="dnav-icon">ğŸ“¥</span>
        <span class="dnav-label">Import Project</span>
      </button>
      <div class="drawer-divider"></div>
      <span class="drawer-section-label">Preferences</span>
      <button class="drawer-nav-item" onclick="closeDrawer();toggleTheme()">
        <span class="dnav-icon" id="dnav-theme-icon">ğŸŒ™</span>
        <span class="dnav-label">Toggle Theme</span>
      </button>
    </nav>
    <div class="drawer-footer">
      <div style="display:flex;gap:0.5rem;width:100%;">
        <button class="lang-btn" onclick="setLang('en');updateDrawerActive()" style="flex:1;padding:0.6rem;">EN</button>
        <button class="lang-btn" onclick="setLang('pl');updateDrawerActive()" style="flex:1;padding:0.6rem;">PL</button>
      </div>
    </div>
  </div>


  <!-- â”€â”€ iOS Bottom Tab Bar â”€â”€ -->
  <div id="ios-tab-bar">
    <button class="ios-tab-btn active" id="tab-home" onclick="showScreen('topic')">
      <span class="tab-icon">ğŸ </span>
      <span>Home</span>
    </button>
    <button class="ios-tab-btn" id="tab-projects" onclick="showScreen('projects')">
      <span class="tab-icon">ğŸ“</span>
      <span id="tab-projects-label">Projects</span>
      <span class="ios-tab-badge" id="tab-badge" style="display:none;"></span>
    </button>
    <button class="ios-tab-btn" id="tab-chat" onclick="showScreen('chat')" style="display:none;">
      <span class="tab-icon">ğŸ’¬</span>
      <span>Interview</span>
    </button>
    <button class="ios-tab-btn" id="tab-results" onclick="showScreen('results')" style="display:none;">
      <span class="tab-icon">âš¡</span>
      <span>Team</span>
    </button>
    <button class="ios-tab-btn" id="tab-settings" onclick="toggleDrawer()">
      <span class="tab-icon">âš™ï¸</span>
      <span>Menu</span>
    </button>
  </div>

  <div id="app">

    <header>
      <div class="logo">
        <div class="logo-icon">âš¡</div>
        Agent<span>Spark</span>
      </div>
      <div style="display:flex;align-items:center;gap:1rem;">
        <span class="save-indicator" id="save-indicator">âœ“ saved</span>
        <div id="apiKeyHeader" style="display:none;align-items:center;gap:0.5rem;">
          <span id="headerModelBadge"
            style="font-family:'Space Mono',monospace;font-size:0.62rem;padding:0.2rem 0.55rem;border-radius:4px;background:rgba(242,185,13,0.1);border:1px solid rgba(242,185,13,0.25);color:var(--accent);white-space:nowrap;"></span>
          <input type="password" class="input-field" id="apiKeyInput" placeholder="API Key"
            style="width:190px;padding:0.5rem 1rem;font-size:0.82rem;" oninput="checkApiKey()" />
          <span class="api-key-status" id="apiKeyStatus"></span>
        </div>
        <div class="lang-switch">
          <button class="lang-btn active" onclick="setLang('en')" id="btn-en">EN</button>
          <button class="lang-btn" onclick="setLang('pl')" id="btn-pl">PL</button>
        </div>
        <button id="burger-btn" onclick="toggleDrawer()" aria-label="Menu" aria-expanded="false"
          aria-controls="nav-drawer">
          <span class="burger-bar"></span>
          <span class="burger-bar"></span>
          <span class="burger-bar"></span>
        </button>
        <button class="theme-toggle" id="theme-toggle-btn" onclick="toggleTheme()" title="Toggle Theme">ğŸŒ™</button>
      </div>
    </header>

    <main>

      <!-- SCREEN 0: MY PROJECTS -->
      <div class="screen" id="screen-projects">
        <div class="ios-screen-header">
          <div class="ios-nav-bar">
            <button class="ios-nav-back" onclick="showScreen('topic')"></button>
            <span class="ios-nav-title">My Projects</span>
            <button class="ios-nav-action" onclick="showScreen('topic')">+ New</button>
          </div>
        </div>
        <div style="max-width:900px;margin:1.5rem auto 0;">
          <div
            style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;gap:1rem;flex-wrap:wrap;">
            <div class="ios-search" style="flex:1;max-width:320px;">
              <span class="ios-search-icon">ğŸ”</span>
              <input id="projects-search" type="text" placeholder="Search projectsâ€¦" oninput="renderProjectsList()" />
            </div>
            <button class="btn-primary" onclick="showScreen('topic')" style="flex-shrink:0;">+ New Project</button>
          </div>
          <div id="projects-list"
            style="display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:1.25rem;"></div>
          <div id="projects-empty" style="display:none;">
            <div class="empty-state">
              <div class="empty-state-icon">ğŸ“‚</div>
              <div class="empty-state-title">No projects yet</div>
              <div class="empty-state-sub">Build your first AI team and it will appear here automatically.</div>
              <button class="btn-primary" onclick="showScreen('topic')" style="margin-top:0.5rem;">+ Start a
                project</button>
            </div>
          </div>
        </div>
      </div>

      <!-- SCREEN 1: TOPIC SELECTION -->
      <div class="screen active" id="screen-topic">
        <div class="hero">
          <div class="hero-badge" id="badge-text">AI AGENT TEAM GENERATOR</div>
          <h1 id="hero-title">Build Your<br />AI Dream Team</h1>
          <p id="hero-sub">Choose a topic. Answer a few questions. Get a complete AI agent team â€” ready to build your
            app with Google Antigravity.</p>

          <div id="apiKeySetup" style="margin-bottom:2rem;">
            <div class="api-setup-toggle" onclick="toggleApiSetup()" id="api-setup-toggle">
              <div class="api-setup-toggle-left">
                <span class="api-key-dot" id="api-key-dot"></span>
                <span id="api-setup-toggle-label">AI Model & API Key</span>
              </div>
              <span class="api-setup-chevron" id="api-setup-chevron">â–¾</span>
            </div>
            <div class="api-setup-body" id="api-setup-body">
              <div class="api-setup-body-inner">
                <div
                  style="background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:1.1rem;max-width:480px;margin:0 auto;">
                  <div class="model-select-wrap">
                    <label class="api-label">AI Model</label>
                    <select class="model-select" id="modelSelect" onchange="onModelChange()">
                      <optgroup label="â”€â”€ Google Gemini â”€â”€">
                        <option
                          value="gemini|gemini-3.1-pro|https://generativelanguage.googleapis.com/v1beta/models/{model}:generateContent?key={key}|gemini">
                          Gemini 3.1 Pro</option>
                        <option
                          value="gemini|gemini-3-flash|https://generativelanguage.googleapis.com/v1beta/models/{model}:generateContent?key={key}|gemini">
                          Gemini 3 Flash</option>
                        <option
                          value="gemini|gemini-2.5-pro|https://generativelanguage.googleapis.com/v1beta/models/{model}:generateContent?key={key}|gemini">
                          Gemini 2.5 Pro</option>
                        <option
                          value="gemini|gemini-3-flash-preview|https://generativelanguage.googleapis.com/v1beta/models/{model}:generateContent?key={key}|gemini"
                          selected>Gemini 3 Flash Preview</option>
                      </optgroup>
                      <optgroup label="â”€â”€ OpenAI GPT â”€â”€">
                        <option value="openai|gpt-5.2|https://api.openai.com/v1/chat/completions|openai">GPT-5.2
                        </option>
                        <option value="openai|gpt-5.1|https://api.openai.com/v1/chat/completions|openai">GPT-5.1
                        </option>
                        <option value="openai|gpt-5|https://api.openai.com/v1/chat/completions|openai">GPT-5</option>
                        <option value="openai|gpt-5-mini|https://api.openai.com/v1/chat/completions|openai">GPT-5 mini
                        </option>
                        <option value="openai|gpt-5-nano|https://api.openai.com/v1/chat/completions|openai">GPT-5 nano
                        </option>
                      </optgroup>
                      <optgroup label="â”€â”€ Anthropic Claude â”€â”€">
                        <option value="anthropic|claude-opus-4-6|https://api.anthropic.com/v1/messages|anthropic">Claude
                          Opus 4.6</option>
                        <option value="anthropic|claude-opus-4-5|https://api.anthropic.com/v1/messages|anthropic">Claude
                          Opus 4.5</option>
                        <option value="anthropic|claude-sonnet-4-5|https://api.anthropic.com/v1/messages|anthropic">
                          Claude Sonnet 4.5</option>
                        <option
                          value="anthropic|claude-haiku-4-5-20251001|https://api.anthropic.com/v1/messages|anthropic">
                          Claude Haiku 4.5</option>
                      </optgroup>
                    </select>
                    <div class="model-hint" id="modelHint">Key: Google AI Studio â†’
                      <strong>makersuite.google.com</strong></div>
                  </div>
                  <label class="api-label"><span id="apiKeyLabel">Gemini API Key</span> <span
                      style="color:var(--muted);font-size:0.7rem;">(required)</span></label>
                  <div class="api-key-area">
                    <input type="password" class="input-field" id="apiKeySetupInput" placeholder="AIza..."
                      oninput="syncApiKey(this.value)" />
                  </div>
                  <div class="api-key-status" id="apiKeySetupStatus"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Home segmented nav -->
          <div class="home-seg-nav" role="tablist" aria-label="Home sections">
            <button class="home-seg-btn active" id="hseg-topics" role="tab" aria-selected="true"
              onclick="switchHomePanel('topics')">ğŸ”¥ Topics</button>
            <button class="home-seg-btn" id="hseg-custom" role="tab" aria-selected="false"
              onclick="switchHomePanel('custom')">âœï¸ Custom</button>
          </div>

          <div class="home-panel active" id="hpanel-topics">
            <div class="level-section">
              <span class="level-section-label" id="level-section-label">COMPLEXITY LEVEL</span>
              <div class="level-grid" id="level-grid"></div>
            </div>
            <div class="template-filters" id="template-filters"></div>
            <div class="topic-grid" id="topic-grid"></div>
          </div>

          <div class="home-panel" id="hpanel-custom">
            <div style="max-width:560px;margin:0 auto;padding:1rem 0 2rem;">
              <div class="or-divider" id="or-text" style="margin-bottom:1.5rem;">Describe your project</div>
              <div class="custom-topic">
                <input type="text" class="input-field" id="customTopic"
                  placeholder="e.g. AI-powered recipe recommender..." />
                <button class="btn-primary" onclick="startWithTopic()" id="start-btn">Start â†’</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- SCREEN 2: CHAT INTERVIEW -->
      <div class="screen" id="screen-chat">
        <div class="ios-screen-header">
          <div class="ios-nav-bar">
            <button class="ios-nav-back" onclick="restart()">Cancel</button>
            <span class="ios-nav-title" id="ios-chat-nav-title">AI Interview</span>
            <span class="ios-nav-action" id="ios-chat-step-label" style="color:var(--muted);font-size:0.8rem;"></span>
          </div>
          <div class="ios-progress-bar-wrap" id="ios-progress-bar" style="padding: 0 1.25rem 0.6rem;"></div>
        </div>
        <div class="chat-layout">
          <div class="chat-main">
            <div class="chat-header">
              <div class="status-dot"></div>
              <div>
                <div class="title" id="chat-title">AI Interview</div>
                <div class="subtitle" id="chat-subtitle">Building your agent profile...</div>
              </div>
            </div>
            <div class="chat-messages" id="chat-messages"></div>
            <div class="question-panel" id="question-panel" style="display:none;">
              <div class="question-panel-text" id="question-panel-text"></div>
              <div class="question-panel-choices" id="question-panel-choices"></div>
            </div>
          </div>
          <div class="chat-sidebar">
            <div class="sidebar-card">
              <h3>PROGRESS</h3>
              <div class="progress-steps" id="progress-steps"></div>
            </div>
            <div class="sidebar-card">
              <h3>TOPIC</h3>
              <div id="sidebar-topic" style="font-size:0.9rem;font-weight:600;"></div>
            </div>
            <div class="sidebar-card">
              <h3>LEVEL</h3>
              <div id="sidebar-level" style="font-size:1.3rem;"></div>
              <div id="sidebar-level-name" style="font-size:0.9rem;font-weight:700;margin-top:0.2rem;"></div>
              <div id="sidebar-level-desc"
                style="font-size:0.72rem;color:var(--muted);margin-top:0.2rem;line-height:1.4;"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- SCREEN 3: RESULTS -->
      <div class="screen" id="screen-results">
        <div class="ios-screen-header">
          <div class="ios-nav-bar">
            <button class="ios-nav-back" onclick="restart()">Start Over</button>
            <span class="ios-nav-title">Your Team</span>
            <button class="ios-nav-action" onclick="downloadZip()">Export</button>
          </div>
        </div>
        <div id="shared-banner" class="shared-banner" style="display:none;">
          <div class="shared-banner-icon">ğŸ”—</div>
          <div class="shared-banner-text">
            <div class="shared-banner-title" id="shared-banner-title">Shared team</div>
            <div class="shared-banner-sub" id="shared-banner-sub">This is a read-only shared view.</div>
          </div>
          <button class="shared-banner-close"
            onclick="document.getElementById('shared-banner').style.display='none'">âœ•</button>
        </div>

        <div class="results-header">
          <div class="hero-badge" id="result-badge">MISSION COMPLETE</div>
          <h2 id="result-title">Your AI Team is Ready</h2>
          <p id="result-sub" style="color:var(--muted);">Download your files and deploy to Google Antigravity</p>
        </div>

        <div id="refine-panel" class="refine-panel" style="display:none;">
          <div class="refine-header">
            <div>
              <h3 id="refine-title">Refine Your Team</h3>
              <p id="refine-sub">Tell the AI what you want to change.</p>
            </div>
            <button class="refine-close-btn" onclick="closeRefine()">âœ•</button>
          </div>
          <div id="refine-step1">
            <div class="refine-chips-label" id="refine-chips-label">Quick suggestions:</div>
            <div class="refine-action-chips" id="refine-action-chips"></div>
            <div class="refine-input-row">
              <textarea class="refine-textarea" id="refine-input" placeholder="e.g. Add a Security Agent..."
                rows="3"></textarea>
            </div>
            <div class="refine-step1-footer">
              <button class="btn-primary refine-send-btn" id="refine-submit-btn" onclick="submitRefine()">Send
                â†’</button>
            </div>
          </div>
          <div id="refine-step2" style="display:none;">
            <div class="refine-history" id="refine-history"></div>
            <div class="refine-step2-footer">
              <button class="refine-revert-btn" id="refine-revert-btn" onclick="revertLastRefine()"
                style="display:none;">â†© Revert</button>
              <button class="refine-edit-btn" onclick="backToRefineStep1()">âœ Edit</button>
              <button class="btn-primary refine-apply-btn" id="refine-apply-btn" onclick="applyRefinement()"
                style="display:none;">âœ“ Apply Changes</button>
            </div>
          </div>
        </div>

        <div id="scoring-panel" class="scoring-panel" style="display:none;"></div>
        <div id="graph-section" class="graph-section" style="display:none;">
          <div class="section-header-bar">
            <span>ğŸ•¸</span>
            <span id="graph-title">Agent Dependency Graph</span>
          </div>
          <div class="graph-container">
            <canvas id="agent-graph" width="800" height="400"></canvas>
          </div>
        </div>
        <div id="agents-grid" class="agents-grid"></div>
        <div id="instructions-section" class="instructions" style="display:none;">
          <h3 id="instr-title" style="margin-bottom:1rem;">How to upload to Google Antigravity</h3>
          <div class="instruction-steps" id="instr-steps"></div>
        </div>

        <div class="results-actions results-actions-secondary">
          <h3
            style="font-size:0.72rem;font-family:'Space Mono',monospace;letter-spacing:0.12em;color:var(--accent);margin-bottom:1rem;">
            ACTIONS</h3>
          <div class="ios-action-group">
            <button class="ios-action-btn primary-action" onclick="downloadZip()" id="download-btn">
              <span class="ios-action-icon">â¬‡</span>
              <span>Download ZIP</span>
            </button>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:0.5rem;">
              <button class="ios-action-btn" onclick="openShareModal()">ğŸ”— Share</button>
              <button class="ios-action-btn" onclick="openRefine()">âœï¸ Refine</button>
              <button class="ios-action-btn" onclick="openMdBrowser()">ğŸ“„ Docs</button>
              <button class="ios-action-btn" onclick="openFrameworkExport()">ğŸš€ Export</button>
              <button class="ios-action-btn" onclick="openImportModal()">ğŸ“¥ Import</button>
              <button class="ios-action-btn" onclick="showInstructions()">ğŸ“– Guide</button>
            </div>
            <button class="ios-action-cancel" onclick="restart()">â†© Start Over</button>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- â”€â”€ OVERLAYS â”€â”€ -->
  <div class="ios-sheet-overlay" id="modal">
    <div class="ios-sheet">
      <div class="ios-sheet-handle"></div>
      <div class="ios-sheet-body" id="modal-body"></div>
      <div class="modal-footer">
        <button class="modal-download-btn" onclick="closeModal()">Close</button>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="md-browser-modal">
    <div class="modal" style="max-width:960px;">
      <div class="modal-header">
        <div class="modal-title">ğŸ“„ Documentation Preview</div>
        <button class="modal-close" onclick="closeMdBrowser()">âœ•</button>
      </div>
      <div style="display:flex;height:60vh;">
        <div id="md-browser-sidebar" style="width:200px;border-right:1px solid var(--border);overflow-y:auto;"></div>
        <div id="md-browser-content" style="flex:1;overflow-y:auto;padding:1rem;">
          <div class="md-preview" id="md-browser-rendered"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="share-modal">
    <div class="modal" style="max-width:500px;">
      <div class="modal-header">
        <div class="modal-title">ğŸ”— Share Project</div>
        <button class="modal-close" onclick="closeModal()">âœ•</button>
      </div>
      <div style="padding:1.5rem;">
        <input type="text" class="share-url-input" id="share-url-display" readonly
          style="width:100%;padding:0.75rem;margin-bottom:1rem;" />
        <button class="btn-primary" onclick="copyShareUrl()" style="width:100%;">Copy Link</button>
      </div>
    </div>
  </div>

  <script type="module" src="js/app/main.js"></script>

  <div id="sticky-context-bar"></div>
  <button id="back-to-top" onclick="scrollToTop()">â†‘</button>

</body>

</html>